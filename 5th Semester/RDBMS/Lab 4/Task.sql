-- Task A

-- A.1
CREATE TABLE CUSTOMERS(
    C_ID NUMBER,
    C_NAME VARCHAR2(20),
    DOB VARCHAR2(20),
    CONSTRAINT PK_CUSTOMER_CID PRIMARY KEY(C_ID)
);

CREATE TABLE ADDRESS(
    ID NUMBER,
    DIVISION VARCHAR2(20),
    DISTRICT VARCHAR2(20),
    CONSTRAINT FK_ADDRESS_ID FOREIGN KEY(ID) REFERENCES CUSTOMERS
);

CREATE TABLE SUBSCRIPTION(
    ID NUMBER,
    SUBS_LEVEL VARCHAR2(20),
    LIFETIME_USAGE NUMBER,
    CONSTRAINT FK_SUBSCRIBER FOREIGN KEY(ID) REFERENCES CUSTOMERS
);


-- A.2
INSERT INTO CUSTOMERS VALUES(1, 'ISHRAK', '30/04/1997');
INSERT INTO CUSTOMERS VALUES(2, 'ISHFAR', '21/06/1997');
INSERT INTO CUSTOMERS VALUES(3, 'LAMI', '16/09/1997');
INSERT INTO CUSTOMERS VALUES(4, 'EKSAN', '31/06/1998');
INSERT INTO CUSTOMERS VALUES(5, 'ABIR', '23/10/1997');
INSERT INTO CUSTOMERS VALUES(6, 'SAAD', '15/06/1997');
INSERT INTO CUSTOMERS VALUES(7, 'OISHEE', '08/04/1997');
INSERT INTO CUSTOMERS VALUES(8, 'PREOTY', '01/02/1998');
INSERT INTO CUSTOMERS VALUES(9, 'EUSHA', '02/01/1997');
INSERT INTO CUSTOMERS VALUES(10, 'NAHID', '17/07/1997');
SELECT * FROM CUSTOMERS;

INSERT INTO ADDRESS VALUES(1, 'MIRPUR', 'DHAKA');
INSERT INTO ADDRESS VALUES(2, 'MALIBAGH', 'DHAKA');
INSERT INTO ADDRESS VALUES(3, 'UTTARA', 'UTTARA');
INSERT INTO ADDRESS VALUES(4, 'RAMPURA', 'DHAKA');
INSERT INTO ADDRESS VALUES(5, 'MOHAMMADPUR', 'DHAKA');
INSERT INTO ADDRESS VALUES(6, 'KATHALBAGAN', 'DHAKA');
INSERT INTO ADDRESS VALUES(7, 'MOHAMMADPUR', 'DHAKA');
INSERT INTO ADDRESS VALUES(8, 'UTTARA', 'UTTARA');
INSERT INTO ADDRESS VALUES(9, 'KHILGAON', 'DHAKA');
INSERT INTO ADDRESS VALUES(10, 'MIRPUR', 'DHAKA');
SELECT * FROM ADDRESS;

INSERT INTO SUBSCRIPTION VALUES(1, 'BRONZE', 50);
INSERT INTO SUBSCRIPTION VALUES(4, 'BRONZE', 70);
INSERT INTO SUBSCRIPTION VALUES(7, 'BRONZE', 20);
INSERT INTO SUBSCRIPTION VALUES(10, 'BRONZE', 60);
INSERT INTO SUBSCRIPTION VALUES(2, 'SILVER', 150);
INSERT INTO SUBSCRIPTION VALUES(6, 'SILVER', 190);
INSERT INTO SUBSCRIPTION VALUES(9, 'SILVER', 290);
INSERT INTO SUBSCRIPTION VALUES(3, 'PLATINUM', 380);
INSERT INTO SUBSCRIPTION VALUES(5, 'PLATINUM', 706);
INSERT INTO SUBSCRIPTION VALUES(8, 'PLATINUM', 867);
SELECT * FROM SUBSCRIPTION;


-- A.3
SELECT C.C_NAME, C.DOB, A.DISTRICT, A.DIVISION
FROM CUSTOMERS C, ADDRESS A, SUBSCRIPTION S
WHERE C.C_ID = A.ID 
AND C.C_ID = S.ID
AND S.SUBS_LEVEL = 'PLATINUM' 
AND S.LIFETIME_USAGE > (
    SELECT 2 * MAX(SB.LIFETIME_USAGE)
    FROM SUBSCRIPTION SB
    WHERE SB.SUBS_LEVEL = 'SILVER'
);

SELECT *
FROM (
    SELECT C.C_NAME, C.C_ID, S.LIFETIME_USAGE
    FROM CUSTOMERS C, SUBSCRIPTION S
    WHERE C.C_ID = S.ID
    ORDER BY S.LIFETIME_USAGE DESC
)
WHERE ROWNUM <= 5;

UPDATE SUBSCRIPTION S
SET S.SUBS_LEVEL = 'ELITE'
WHERE S.ID IN (
    SELECT C_ID
    FROM (
        SELECT C.C_ID
        FROM CUSTOMERS C, SUBSCRIPTION S
        WHERE C.C_ID = S.ID
        ORDER BY S.LIFETIME_USAGE DESC
    )
    WHERE ROWNUM <= 5
);

-- TASK B
SELECT C_ID||C_NAME
FROM CUSTOMERS;

SELECT INSTR('ASH KETCHUM TURNED TO ASH', 'ASH', 5)
FROM DUAL;

SELECT LOWER(C_NAME)
FROM CUSTOMERS;

SELECT UPPER(C_NAME)
FROM CUSTOMERS;

SELECT LENGTH(C_NAME) AS LENGTH, C_NAME
FROM CUSTOMERS;

SELECT LPAD(C_NAME, 8)
FROM CUSTOMERS;

SELECT RPAD(C_NAME, 8, '*')
FROM CUSTOMERS;

SELECT SUBSTR('ISHRAK', 3, 3)
FROM DUAL;

SELECT COUNT(C_ID)
FROM CUSTOMERS;